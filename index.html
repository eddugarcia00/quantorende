import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

export default function CalculadoraJurosCompostos() {
  const [valorInicial, setValorInicial] = useState(1000);
  const [taxa, setTaxa] = useState(13.65); // Taxa padrão (SELIC)
  const [periodo, setPeriodo] = useState(12); // em meses
  const [tipoInvestimento, setTipoInvestimento] = useState("cdb"); // "cdb" ou "lci"
  const [tipoIndexacao, setTipoIndexacao] = useState("pos"); // "pos" ou "pre"
  const [resultado, setResultado] = useState(null);

  const calcular = () => {
    const valor = parseFloat(valorInicial);
    const taxaDecimal = parseFloat(taxa) / 100;
    const meses = parseInt(periodo);

    let montanteBruto = valor * Math.pow(1 + taxaDecimal / 12, meses);
    let montanteLiquido = montanteBruto;

    if (tipoIndexacao === "pos") {
      if (tipoInvestimento === "cdb") {
        // Aplicação de IR regressivo
        let aliquotaIR = 0.225;
        if (meses > 6 && meses <= 12) aliquotaIR = 0.20;
        else if (meses > 12 && meses <= 24) aliquotaIR = 0.175;
        else if (meses > 24) aliquotaIR = 0.15;

        const rendimento = montanteBruto - valor;
        const imposto = rendimento * aliquotaIR;
        montanteLiquido = montanteBruto - imposto;
      } else if (tipoInvestimento === "lci") {
        // LCI/LCA são isentos de IR
        montanteLiquido = montanteBruto;
      }
    } else {
      // Para tipo "pré", aplicar mesmo cálculo (ajuste conforme necessário futuramente)
      montanteLiquido = montanteBruto;
    }

    setResultado({
      bruto: montanteBruto.toFixed(2),
      liquido: montanteLiquido.toFixed(2),
    });
  };

  return (
    <div className="flex justify-center p-4">
      <Card className="w-full max-w-md shadow-xl rounded-2xl">
        <CardContent className="space-y-4 p-6">
          <h2 className="text-xl font-bold text-center">Calculadora de Investimentos</h2>

          <div>
            <label>Valor Inicial (R$):</label>
            <input
              type="number"
              value={valorInicial}
              onChange={(e) => setValorInicial(e.target.value)}
              className="w-full p-2 border rounded"
            />
          </div>

          <div>
            <label>Taxa (% ao ano):</label>
            <input
              type="number"
              value={taxa}
              onChange={(e) => setTaxa(e.target.value)}
              className="w-full p-2 border rounded"
            />
          </div>

          <div>
            <label>Período (meses):</label>
            <input
              type="number"
              value={periodo}
              onChange={(e) => setPeriodo(e.target.value)}
              className="w-full p-2 border rounded"
            />
          </div>

          <div className="flex justify-between">
            <Button
              variant={tipoInvestimento === "cdb" ? "default" : "outline"}
              onClick={() => setTipoInvestimento("cdb")}
            >
              CDB
            </Button>
            <Button
              variant={tipoInvestimento === "lci" ? "default" : "outline"}
              onClick={() => setTipoInvestimento("lci")}
            >
              LCI/LCA
            </Button>
          </div>

          <div className="flex justify-between">
            <Button
              variant={tipoIndexacao === "pos" ? "default" : "outline"}
              onClick={() => setTipoIndexacao("pos")}
            >
              Pós
            </Button>
            <Button
              variant={tipoIndexacao === "pre" ? "default" : "outline"}
              onClick={() => setTipoIndexacao("pre")}
            >
              Pré
            </Button>
          </div>

          <Button className="w-full mt-4" onClick={calcular}>
            Calcular
          </Button>

          {resultado && (
            <div className="text-center mt-4">
              <p>Montante Bruto: <strong>R$ {resultado.bruto}</strong></p>
              <p>Montante Líquido: <strong>R$ {resultado.liquido}</strong></p>
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}
